{"ast":null,"code":"import _toConsumableArray from\"/Users/olgasivyuk/dev/react-mesto-auth/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"/Users/olgasivyuk/dev/react-mesto-auth/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/Users/olgasivyuk/dev/react-mesto-auth/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect}from'react';import{api}from'../utils/Api.js';import{Route,Switch,Redirect,useHistory}from'react-router-dom';import*as Auth from'../utils/Auth.js';import ProtectedRoute from'./ProtectedRoute';import Header from'./Header';import Main from'./Main';import Login from'./Login';import Register from'./Register';import InfoToolTip from'./InfoToolTip';import EditProfilePopup from'./EditProfilePopup';import EditAvatarPopup from'./EditAvatarPopup';import AddPlacePopup from'./AddPlacePopup';import ImagePopup from'./ImagePopup';import DeleteCardConfirmPopup from'./DeleteCardConfirmPopup';import Footer from'./Footer';import{CurrentUserContext}from'../contexts/CurrentUserContext';import successSignImg from'../images/union.svg';import unSuccessSignImg from'../images/union-wrong.svg';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function App(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isEditAvatarPopupOpen=_useState2[0],setIsEditAvatarPopupOpen=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isEditProfilePopupOpen=_useState4[0],setIsEditProfilePopupOpen=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isAddPlacePopupOpen=_useState6[0],setIsAddPlacePopupOpen=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isDeleteCardConfirmPopupOpen=_useState8[0],setIsDeleteCardConfirmPopupOpen=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),cards=_useState10[0],setCards=_useState10[1];var _useState11=useState(null),_useState12=_slicedToArray(_useState11,2),selectedCard=_useState12[0],setSelectedCard=_useState12[1];var _useState13=useState(null),_useState14=_slicedToArray(_useState13,2),removeCard=_useState14[0],setRemoveCard=_useState14[1];var _useState15=useState({}),_useState16=_slicedToArray(_useState15,2),currentUser=_useState16[0],setCurrentUser=_useState16[1];var _useState17=useState({_id:'',email:''}),_useState18=_slicedToArray(_useState17,2),userData=_useState18[0],setUserData=_useState18[1];var _useState19=useState(false),_useState20=_slicedToArray(_useState19,2),loggedIn=_useState20[0],setLoggedIn=_useState20[1];var _useState21=useState(false),_useState22=_slicedToArray(_useState21,2),isInfoToolTipOpen=_useState22[0],setIsInfoToolTipOpen=_useState22[1];var _useState23=useState({image:'',text:''}),_useState24=_slicedToArray(_useState23,2),isInfoTooltipMessage=_useState24[0],setIsInfoTooltipMessage=_useState24[1];var history=useHistory();useEffect(function(){// попробовать еще раз прописать данные пользователя и карточек в одном useEffect\napi.getProfile().then(function(userData){setCurrentUser(_objectSpread(_objectSpread({},userData),{},{userName:userData.name,userDescription:userData.about,userAvatar:userData.avatar}));}).catch(function(err){return console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430...: \".concat(err));});},[]);function handleUpdateUser(_ref){var name=_ref.name,about=_ref.about;api.editProfile(name,about).then(function(userData){setCurrentUser(_objectSpread(_objectSpread({},userData),{},{userName:userData.name,userDescription:userData.about,userAvatar:userData.avatar}));closeAllPopups();}).catch(function(err){return console.error(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430...: \".concat(err));});};function handleUpdateAvatar(_ref2){var avatar=_ref2.avatar;api.editProfileAvatar(avatar).then(function(userData){setCurrentUser(_objectSpread(_objectSpread({},userData),{},{userAvatar:userData.avatar}));closeAllPopups();}).catch(function(err){return console.error(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430...: \".concat(err));});};useEffect(function(){api.getUsersCards().then(function(cardList){var usersCard=cardList.map(function(card){return{name:card.name,link:card.link,likes:card.likes,cardId:card._id,ownerId:card.owner._id};});setCards(usersCard);}).catch(function(err){return console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430...: \".concat(err));});},[]);function handleAddPlaceSubmit(_ref3){var name=_ref3.name,link=_ref3.link;api.addNewCard(name,link).then(function(newCard){setCards([{name:newCard.name,link:newCard.link,likes:newCard.likes,cardId:newCard._id,ownerId:newCard.owner._id}].concat(_toConsumableArray(cards)));closeAllPopups();}).catch(function(err){return console.error(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430...: \".concat(err));});};function handleCardLike(card){var isLiked=card.likes.some(function(user){return user._id===currentUser._id;});if(isLiked){api.deleteLike(card.cardId).then(function(newCard){setCards(function(state){return state.map(function(item){if(item.cardId===card.cardId){return{name:newCard.name,link:newCard.link,likes:newCard.likes,cardId:newCard._id,ownerId:newCard.owner._id};}else return item;});});}).catch(function(err){return console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430...: \".concat(err));});}else{api.addLike(card.cardId).then(function(newCard){setCards(function(stateCards){return stateCards.map(function(item){if(item.cardId===card.cardId){return{name:newCard.name,link:newCard.link,likes:newCard.likes,cardId:newCard._id,ownerId:newCard.owner._id};}else return item;});});}).catch(function(err){return console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430...: \".concat(err));});}};function handleDeleteCard(){api.deleteCard(removeCard.cardId).then(function(){setCards(function(stateCards){return stateCards.filter(function(item){return item.cardId!==removeCard.cardId;});});closeAllPopups();}).catch(function(err){return console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430...: \".concat(err));});};useEffect(function(){handleCheckToken();},[]);useEffect(function(){if(loggedIn){history.push('/');}},[loggedIn]);function handleRegister(_ref4){var password=_ref4.password,email=_ref4.email;return Auth.register(password,email).then(function(res){console.log('res',res);var email=res.data.email;setUserData(_objectSpread(_objectSpread({},userData),{},{email:email}));setIsInfoTooltipMessage({image:successSignImg,text:'Вы успешно зарегистрировались!'});history.push('/signin');}).catch(function(err){console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430...: \".concat(err));setIsInfoTooltipMessage({image:unSuccessSignImg,text:'Что-то пошло не так! Попробуйте ещё раз.'});}).finally(function(){setIsInfoToolTipOpen(true);});};function handleLogin(_ref5){var password=_ref5.password,email=_ref5.email;return Auth.authorize(password,email).then(function(data){if(data.token){localStorage.setItem('jwt',data.token);handleCheckToken();history.push('/');}}).catch(function(err){console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430...: \".concat(err));setIsInfoTooltipMessage({image:unSuccessSignImg,text:'Неверный email или пароль. Попробуйте ещё раз.'});setIsInfoToolTipOpen(true);});};function handleCheckToken(){if(localStorage.getItem('jwt')){var token=localStorage.getItem('jwt');Auth.getContent(token).then(function(res){var _res$data=res.data,_id=_res$data._id,email=_res$data.email;setLoggedIn(true);setUserData({_id:_id,email:email});//history.push('/');\n}).catch(function(err){console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430...: \".concat(err));});}}function handleLogOut(){localStorage.removeItem('jwt');setLoggedIn(false);setUserData({_id:'',email:''});history.push('/signin');}function handleEditAvatarClick(){setIsEditAvatarPopupOpen(true);};function handleEditProfileClick(){setIsEditProfilePopupOpen(true);};function handleAddPlaceClick(){setIsAddPlacePopupOpen(true);};function handleCardClick(card){setSelectedCard(card);};function handleTrashbinClick(card){setIsDeleteCardConfirmPopupOpen(true);setRemoveCard(card);}function closeAllPopups(){setIsEditAvatarPopupOpen(false);setIsEditProfilePopupOpen(false);setIsAddPlacePopupOpen(false);setSelectedCard(null);setIsDeleteCardConfirmPopupOpen(false);setIsInfoToolTipOpen(false);};return/*#__PURE__*/_jsx(CurrentUserContext.Provider,{value:currentUser,children:/*#__PURE__*/_jsxs(\"div\",{className:\"page\",children:[/*#__PURE__*/_jsx(Header,{loggedIn:loggedIn,handleLogOut:handleLogOut,userData:userData}),/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(ProtectedRoute,{exact:true,path:\"/\",loggedIn:loggedIn,component:Main,onEditAvatar:handleEditAvatarClick,onEditProfile:handleEditProfileClick,onAddPlace:handleAddPlaceClick,onCardClick:handleCardClick,onCardLike:handleCardLike,onCardDelete:handleTrashbinClick,cards:cards}),/*#__PURE__*/_jsx(Route,{path:\"/signup\",children:/*#__PURE__*/_jsx(Register,{handleRegister:handleRegister})}),/*#__PURE__*/_jsx(Route,{path:\"/signin\",children:/*#__PURE__*/_jsx(Login,{handleLogin:handleLogin})}),/*#__PURE__*/_jsx(Route,{children:loggedIn?/*#__PURE__*/_jsx(Redirect,{to:\"/\"}):/*#__PURE__*/_jsx(Redirect,{to:\"/signin\"})})]}),/*#__PURE__*/_jsx(Footer,{}),/*#__PURE__*/_jsx(EditProfilePopup,{isOpen:isEditProfilePopupOpen,onClose:closeAllPopups,onUpdateUser:handleUpdateUser}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar}),/*#__PURE__*/_jsx(AddPlacePopup,{isOpen:isAddPlacePopupOpen,onClose:closeAllPopups,onAddPlace:handleAddPlaceSubmit}),/*#__PURE__*/_jsx(DeleteCardConfirmPopup,{isOpen:isDeleteCardConfirmPopupOpen,onClose:closeAllPopups,onConfirmCardDelete:handleDeleteCard}),/*#__PURE__*/_jsx(ImagePopup,{card:selectedCard,onClose:closeAllPopups}),/*#__PURE__*/_jsx(InfoToolTip,{isOpen:isInfoToolTipOpen,onClose:closeAllPopups,image:isInfoTooltipMessage.image,text:isInfoTooltipMessage.text})]})});}export default App;// return Auth.register(password, email)\n// .then(() => {\n//   history.push('/signin');\n// })\n// .catch(err => {\n//   console.log(`Ошибка...: ${err}`);\n// })","map":{"version":3,"sources":["/Users/olgasivyuk/dev/react-mesto-auth/src/components/App.js"],"names":["useState","useEffect","api","Route","Switch","Redirect","useHistory","Auth","ProtectedRoute","Header","Main","Login","Register","InfoToolTip","EditProfilePopup","EditAvatarPopup","AddPlacePopup","ImagePopup","DeleteCardConfirmPopup","Footer","CurrentUserContext","successSignImg","unSuccessSignImg","App","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","isDeleteCardConfirmPopupOpen","setIsDeleteCardConfirmPopupOpen","cards","setCards","selectedCard","setSelectedCard","removeCard","setRemoveCard","currentUser","setCurrentUser","_id","email","userData","setUserData","loggedIn","setLoggedIn","isInfoToolTipOpen","setIsInfoToolTipOpen","image","text","isInfoTooltipMessage","setIsInfoTooltipMessage","history","getProfile","then","userName","name","userDescription","about","userAvatar","avatar","catch","err","console","log","handleUpdateUser","editProfile","closeAllPopups","error","handleUpdateAvatar","editProfileAvatar","getUsersCards","cardList","usersCard","map","card","link","likes","cardId","ownerId","owner","handleAddPlaceSubmit","addNewCard","newCard","handleCardLike","isLiked","some","user","deleteLike","state","item","addLike","stateCards","handleDeleteCard","deleteCard","filter","handleCheckToken","push","handleRegister","password","register","res","data","finally","handleLogin","authorize","token","localStorage","setItem","getItem","getContent","handleLogOut","removeItem","handleEditAvatarClick","handleEditProfileClick","handleAddPlaceClick","handleCardClick","handleTrashbinClick"],"mappings":"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","sourcesContent":["import { useState, useEffect } from 'react';\nimport { api } from '../utils/Api.js';\nimport { Route, Switch, Redirect, useHistory } from 'react-router-dom';\nimport * as Auth from '../utils/Auth.js';\nimport ProtectedRoute from './ProtectedRoute';\nimport Header from './Header';\nimport Main from './Main';\nimport Login from './Login';\nimport Register from './Register';\nimport InfoToolTip from './InfoToolTip'\nimport EditProfilePopup from './EditProfilePopup';\nimport EditAvatarPopup from './EditAvatarPopup';\nimport AddPlacePopup from './AddPlacePopup'\nimport ImagePopup from './ImagePopup';\nimport DeleteCardConfirmPopup from './DeleteCardConfirmPopup';\nimport Footer from './Footer';\nimport { CurrentUserContext } from '../contexts/CurrentUserContext';\n\nimport successSignImg from '../images/union.svg';\nimport unSuccessSignImg from '../images/union-wrong.svg';\n\nfunction App() {\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = useState(false);\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = useState(false);\n  const [isDeleteCardConfirmPopupOpen, setIsDeleteCardConfirmPopupOpen] = useState(false);\n  \n  const [cards, setCards] = useState([]);\n  const [selectedCard, setSelectedCard] = useState(null);\n  const [removeCard, setRemoveCard] = useState(null);\n  const [currentUser, setCurrentUser] = useState({}); \n\n  const [userData, setUserData] = useState({ _id: '', email: '' });\n  const [loggedIn, setLoggedIn] = useState(false);\n  const [isInfoToolTipOpen, setIsInfoToolTipOpen] = useState(false);\n  const [isInfoTooltipMessage, setIsInfoTooltipMessage] = useState({ image: '', text: '' });\n  \n  const history = useHistory();\n\n  useEffect(() => { // попробовать еще раз прописать данные пользователя и карточек в одном useEffect\n      api.getProfile()\n        .then(userData => {\n          setCurrentUser({...userData,\n            userName: userData.name,\n            userDescription: userData.about,\n            userAvatar: userData.avatar\n          })\n        })\n        .catch((err) => console.log(`Ошибка...: ${err}`));\n    }, []); \n\n    function handleUpdateUser ({name, about}){\n      api.editProfile(name, about)\n      .then(userData => {\n        setCurrentUser({...userData,\n          userName: userData.name,\n          userDescription: userData.about,\n          userAvatar: userData.avatar\n        });\n        closeAllPopups();\n      }).catch(err => console.error(`Ошибка...: ${err}`));\n    };\n\n    function handleUpdateAvatar ({avatar}){\n      api.editProfileAvatar(avatar)\n      .then(userData => {\n        setCurrentUser({...userData,\n          \n          userAvatar: userData.avatar\n        });\n        closeAllPopups();\n      }).catch(err => console.error(`Ошибка...: ${err}`));\n    };\n\n  useEffect(() => {\n    api.getUsersCards()\n      .then((cardList) => {\n        const usersCard = cardList.map((card) => {\n          return {\n            name: card.name,\n            link: card.link,\n            likes: card.likes,\n            cardId: card._id,\n            ownerId: card.owner._id\n          };\n        });\n        setCards(usersCard);\n      })\n      .catch((err) => console.log(`Ошибка...: ${err}`));\n  }, []);\n\n  function handleAddPlaceSubmit({name, link}) {\n    api.addNewCard(name, link)\n    .then (newCard => {\n      setCards([{\n        name: newCard.name,\n        link: newCard.link,\n        likes: newCard.likes,\n        cardId: newCard._id,\n        ownerId: newCard.owner._id\n      }, ...cards]);\n      closeAllPopups();\n    }).catch(err => console.error(`Ошибка...: ${err}`));\n  };\n\n\n  function handleCardLike(card) { \n    const isLiked = card.likes.some(user => user._id === currentUser._id); \n\n    if (isLiked){ \n      api.deleteLike(card.cardId)\n      .then(newCard => { \n        setCards((state) => state.map((item) => {\n          if(item.cardId === card.cardId){\n            return{\n              name: newCard.name,\n              link: newCard.link,\n              likes: newCard.likes,\n              cardId: newCard._id,\n              ownerId: newCard.owner._id\n            }\n          } else return item;\n        }));\n      })\n      .catch(err => console.log(`Ошибка...: ${err}`))\n    } else {\n        api.addLike(card.cardId)\n          .then(newCard => { \n            setCards((stateCards) => stateCards.map((item) => {\n              if(item.cardId === card.cardId){\n                return{\n                  name: newCard.name,\n                  link: newCard.link,\n                  likes: newCard.likes,\n                  cardId: newCard._id,\n                  ownerId: newCard.owner._id\n                }\n              } else return item;\n          }));\n          })\n          .catch(err => console.log(`Ошибка...: ${err}`))\n      } \n   };\n\n  function handleDeleteCard() {\n    api.deleteCard(removeCard.cardId)\n      .then(() => {\n        setCards((stateCards) => stateCards.filter((item) => \n        item.cardId !== removeCard.cardId));\n        closeAllPopups();\n      })\n      .catch(err => console.log(`Ошибка...: ${err}`))\n  };\n\n  useEffect(() => {\n    handleCheckToken();\n  }, []);\n\n  useEffect(() => {\n    if (loggedIn) {\n        history.push('/');\n    }\n  }, [loggedIn]);\n\n  function handleRegister ({password, email}){\n    return Auth.register(password, email)\n      .then(res => {\n        console.log('res', res)\n        const { email } = res.data;\n        setUserData({ ...userData, email })\n        setIsInfoTooltipMessage({ image: successSignImg, text: 'Вы успешно зарегистрировались!' });\n        history.push('/signin');\n      })\n      .catch(err => {\n        console.log(`Ошибка...: ${err}`);\n        setIsInfoTooltipMessage({ image: unSuccessSignImg, text: 'Что-то пошло не так! Попробуйте ещё раз.' })\n      })\n      .finally(() => {\n        setIsInfoToolTipOpen(true);\n      });\n  };\n\n  function handleLogin({password, email}){\n    return Auth.authorize(password, email)\n    .then(data => {\n      if (data.token){\n        localStorage.setItem('jwt', data.token);\n        \n        handleCheckToken();\n        history.push('/');\n      } \n    })\n    .catch(err => {\n      console.log(`Ошибка...: ${err}`);\n      setIsInfoTooltipMessage({ image: unSuccessSignImg, text: 'Неверный email или пароль. Попробуйте ещё раз.' })\n      setIsInfoToolTipOpen(true);\n    })\n  };\n\n  function handleCheckToken(){\n    if (localStorage.getItem('jwt')){\n      let token = localStorage.getItem('jwt')\n      Auth.getContent(token)\n      .then(res => {\n        const { _id, email } = res.data;\n          setLoggedIn(true);\n          setUserData({ _id, email });\n          //history.push('/');\n      })\n      .catch(err => {\n        console.log(`Ошибка...: ${err}`);\n      })\n    }\n  }\n\n  function handleLogOut(){\n    localStorage.removeItem('jwt');\n    setLoggedIn(false);\n    setUserData({ _id: '', email: '' });\n    history.push('/signin')\n  }\n\n  function handleEditAvatarClick() {\n    setIsEditAvatarPopupOpen(true);\n  };\n\n  function handleEditProfileClick() {\n    setIsEditProfilePopupOpen(true);\n  };\n\n  function handleAddPlaceClick() {\n    setIsAddPlacePopupOpen(true);\n  };\n\n  function handleCardClick(card) {\n    setSelectedCard(card);\n  };\n\n  function handleTrashbinClick(card){\n    setIsDeleteCardConfirmPopupOpen(true)\n    setRemoveCard(card)\n  }\n\n  function closeAllPopups() {\n    setIsEditAvatarPopupOpen(false);\n    setIsEditProfilePopupOpen(false);\n    setIsAddPlacePopupOpen(false);\n    setSelectedCard(null);\n    setIsDeleteCardConfirmPopupOpen(false);\n    setIsInfoToolTipOpen(false);\n  };\n\n  return (\n    <CurrentUserContext.Provider value={currentUser}>\n      <div className='page'>\n        <Header\n        loggedIn={loggedIn}\n        handleLogOut={handleLogOut}\n        userData = {userData}/>\n\n        <Switch>\n          <ProtectedRoute exact path='/' loggedIn={loggedIn}\n            component={Main}\n            onEditAvatar={handleEditAvatarClick}\n            onEditProfile={handleEditProfileClick}\n            onAddPlace={handleAddPlaceClick}\n            onCardClick={handleCardClick}\n            onCardLike={handleCardLike}\n            onCardDelete={handleTrashbinClick}\n            cards={cards}\n          ></ProtectedRoute>\n          \n          <Route path='/signup'>\n            <Register handleRegister={handleRegister}/>\n          </Route>\n          \n          <Route path='/signin'>\n            <Login handleLogin={handleLogin}/>\n          </Route>\n          \n          <Route>\n            {loggedIn ? <Redirect to='/' /> : <Redirect to='/signin' />}\n          </Route>\n        </Switch>\n\n        <Footer />\n\n        {/* Модалка редактирования профиля */}\n        <EditProfilePopup\n          isOpen={isEditProfilePopupOpen}\n          onClose={closeAllPopups}\n          onUpdateUser={handleUpdateUser}>\n        </EditProfilePopup>\n\n        {/* Модалка смены аватара */}\n        <EditAvatarPopup\n          isOpen={isEditAvatarPopupOpen}\n          onClose={closeAllPopups}\n          onUpdateAvatar={handleUpdateAvatar}\n        ></EditAvatarPopup>\n\n        {/* Модалка добавления карточки */}\n        <AddPlacePopup\n          isOpen={isAddPlacePopupOpen}\n          onClose={closeAllPopups}\n          onAddPlace={handleAddPlaceSubmit}\n        ></AddPlacePopup>\n\n        {/* Модалка удаления карточки */}\n        <DeleteCardConfirmPopup\n          isOpen={isDeleteCardConfirmPopupOpen}\n          onClose={closeAllPopups}\n          onConfirmCardDelete={handleDeleteCard}\n        ></DeleteCardConfirmPopup>\n\n        {/* Модалка открытия картинки */}\n        <ImagePopup card={selectedCard} onClose={closeAllPopups} />\n\n        {/* Модалка с ответом о регистрации */}\n        <InfoToolTip \n        isOpen={isInfoToolTipOpen}\n        onClose={closeAllPopups}\n        image={isInfoTooltipMessage.image} \n        text={isInfoTooltipMessage.text}>\n        </InfoToolTip>\n      </div>\n    </CurrentUserContext.Provider>\n  );\n}\n\nexport default App;\n\n\n\n// return Auth.register(password, email)\n    // .then(() => {\n    //   history.push('/signin');\n    // })\n    // .catch(err => {\n    //   console.log(`Ошибка...: ${err}`);\n    // })"]},"metadata":{},"sourceType":"module"}